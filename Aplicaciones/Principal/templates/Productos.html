{% extends 'base.html' %}
{% block title %}Productos{% endblock %}
{% load static %}

<!-- bootstrap css -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<!-- FIN bootstrap css -->
<!-- dataTable css -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
<!-- FIN dataTable CSS -->
<!-- font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% block content %}
<h3 class="text-primary font-weight-bolder mb-5">Gesti칩n de productos</h3>


<div class="container mt-4">
  <div class="row">
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
          <div class="table-responsive">
              <table id="products" class="table">
                  <caption>
                      Productos Registrados
                  </caption>
                  <thead>
                      <tr>
                        <th class="tead" data-priority="1">C칩digo</th>
                        <th class="tead" data-priority="2">Producto</th>
                        <th class="tead" data-priority="3">Stock</th>
                        <th class="tead" data-priority="4">Precio</th>
                        <th class="tead" data-priority="5">Activo</th>
                        <th class="tead" data-priority="6">Acciones</th>
                      </tr>
                  </thead>
                  <tbody id="table_productos">
                  
                  </tbody>
              </table>
          </div>
      </div>
  </div>
</div>

<button type="button" class="btn btn-1" onclick="newProduct()">
  <img src="{% static 'images/plus.png' %}" alt="new" class="img">
</button>



<div id="newProd" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="titulo">Nuevo Producto</h4>
      </div>
      <div class="modal-body">
        <form class="col-6" action="/registrarProducto/" method="POST">{% csrf_token %}
          <label class="label1">Codigo</label>
          <input type="number" class="form-control" id="codigo" name="codigo" readonly>
          <label class="label1">Producto</label>
          <input type="text" class="form-control" id="producto" name="producto" required>
          <label class="label1">Stock</label>
          <input type="number" class="form-control" id="stock" name="stock" required>
          <label class="label1">Precio Unit.</label>
          <input type="number" class="form-control" id="precio" name="precio" required>
          <label class="label1">Activo</label>
          <select class="selector" id="activo" name="activo" required>
            <option selected disabled>Seleccione si est치 activo</option>
            <option value="true">Activo</option>
            <option value="false">Inactivo</option>
          </select>
            <button type="submit" class="btn btn-success" id="add">A침adir</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- bootstrap js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<!-- FIN bootstrap js -->

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<!-- jquery -->
<!-- dataTable js -->
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<!-- FIN dataTable js -->

<script>
  let dataTable;
  let dataTableIsInitialized= false;

  const dataTableOptions={
    columnDefs:[
        {orderable:false,targets:[5]},
        {searchable:false,targets:[0,2,3]}
    ]
  };

  const initDataTable= async()=>{
      if(dataTableIsInitialized){
          dataTable.destroy();
      }


      await verProductos();
      dataTable=$('#products').DataTable(dataTableOptions);
      dataTableIsInitialized=true;
  };

  const verProductos=async()=>{
    try{
        const response = await fetch('http://127.0.0.1:8000/verProductos/')
        const data = await response.json();
        console.log(data.productos);
        let content=``;
        if (Array.isArray(data.productos)) {
      data.productos.forEach((producto) => {
        content += `
          <tr>
            <td>${producto.Codigo}</td>
            <td>${producto.Producto}</td>
            <td>${producto.Stock}</td>
            <td>${producto.Precio}</td>
            <td>${producto.Activo}</td>
            <td>
              <button type="button" class="btn btn-warning" onclick="agregar()" data-dismiss="modal" id="add">Editar</button>
              <button type="button" class="btn btn-danger" data-dismiss="modal">Eliminar</button>
            </td>
          </tr>
        `;
      });
    } else {
      console.error("data.usuarios is not an array.");
    }
      table_productos.innerHTML=content;
    }catch(ex){
        alert(ex);
    }
};

window.addEventListener('load',async()=>{
    await initDataTable();

});  
</script>
{% endblock %}