<!--PLANTILLA QUE EXTIENDE LA DE BASE.HTML, OSEASE LA TABLA-->
{% extends 'base.html' %}
{% block title %}Personal{% endblock %}
{% load static %}
<!-- bootstrap css -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<!-- FIN bootstrap css -->
<!-- dataTable css -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
<!-- FIN dataTable CSS -->
<!-- font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

{% block content %}
<h3 class="text-primary font-weight-bolder mb-5">Gestión de Personal</h3>

<div class="container mt-4">
  <div class="row">
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
          <div class="table-responsive">
              <table id="personas" class="table">
                  <caption>
                      Usuarios Registrados
                  </caption>
                  <thead>
                      <tr>
                        <th class="tead" data-priority="2">Código</th>
                        <th class="tead" data-priority="3">Nombre</th>
                        <th class="tead" data-priority="4">Identificación</th>
                        <th class="tead" data-priority="8">Dirección</th>
                        <th class="tead" data-priority="7">Teléfono</th>
                        <th class="tead" data-priority="5">Usuario</th>
                        <th class="tead" data-priority="6">Correo</th>
                        <th class="tead" data-priority="10">Fecha nacimiento</th>
                        <th class="tead" data-priority="11">Género</th>
                        <th class="tead" data-priority="9">Tipo usuario</th>
                        <th class="tead" data-priority="12">Activo</th>
                        <th class="tead" data-priority="1">Acciones</th>
                      </tr>
                  </thead>
                  <tbody id="table_usuarios">

                  </tbody>
              </table>
          </div>
      </div>
  </div>
</div>
<!-- Modal -->
<div id="newUser" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="titulo">Nuevo Usuario</h4>
      </div>
      <div class="modal-body">
        <form action="/registrarUsuario/" method="POST" class="col-6">{% csrf_token %}
          <!-- Etiquetas y campos de entrada para capturar los datos del modal-->
          <label class="label1">Código</label>
          <input type="number" class="form-control" id="codigo" name="codigo" readonly>
          <label class="label1">Nombre</label>
          <input type="text" class="form-control" id="nombre" name="nombre" required>
          <label class="label1">Identificación</label>
          <input type="number" class="form-control" id="identificacion" name="identificacion" required>
          <label class="label1">Dirección</label>
          <input type="text" class="form-control" id="direccion" name="direccion" required>
          <label class="label1">Teléfono</label>
          <input type="tel" class="form-control" id="telefono" name="telefono" onkeypress='return validar_num(event)' required>
          <label class="label1">Usuario</label>
          <input type="text" class="form-control" id="usuario" name="usuario" required>
          <label class="label1">Contraseña</label>
          <input type="password" class="form-control" id="contrasena" name="contrasena" required>
          <label class="label1">Correo</label>
          <input type="email" class="form-control" id="correo" name="correo" required>
          <label class="label1">Fecha Nacimiento</label>
          <input type="date" class="form-control" id="nacimiento" name="nacimiento" required>
          <label class="label1">Género</label>
          <!--Menu desplegable para seleccionar el genero-->
          <select class="selector" aria-label="Default select example" id="genero" name="genero">
            <option selected>Seleccione su genero</option>
            <option>Masculino</option>
            <option>Femenino</option>
            <option>Otro</option>
          </select>

          <!-- Menu para recolectar informacion acerca de que tipo de Usuario se trata -->
          <label class="label1">Tipo Usuario</label>
          <select class="selector" aria-label="Default select example" id="tipouser" name="tipouser">
            <option selected>---</option>
            <option>Administrador</option>
            <option>Vendedor</option>
          </select>
          
          <label class="label1">Activo</label>
          <select class="selector" id="activo" name="activo" required>
            <option selected disabled>Seleccione si está activo</option>
            <option value="true">Activo</option>
            <option value="false">Inactivo</option>
          </select>


          <!-- Footer del modal para los botone-->
          <div class="modal-footer">
            <button type="submit" class="btn btn-success" onclick="agregar()" id="add">Añadir</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- Boton menu agregar persona -->
<button type="button" class="btn btn-1" onclick="newPerson()">
  <img src="{% static 'images/plus.png' %}" alt="new" class="img">
</button>




<!-- bootstrap js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<!-- FIN bootstrap js -->

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<!-- jquery -->
<!-- dataTable js -->
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<!-- FIN dataTable js -->


<script>
  let dataTable;
  let dataTableIsInitialized= false;

  const dataTableOptions={
    columnDefs:[
        {className:'centered',targets:[0,1,2,3,4,5,6]},
        {orderable:false,targets:[5,6]},
        {searchable:false,targets:[0,5,6]}
    ]
  };

  const initDataTable= async()=>{
      if(dataTableIsInitialized){
          dataTable.destroy();
      }


      await verUsuarios();
      dataTable=$('#personas').DataTable(dataTableOptions);
      dataTableIsInitialized=true;
  };

  const verUsuarios=async()=>{
    try{
        const response = await fetch('http://127.0.0.1:8000/verUsuarios/')
        const data = await response.json();
        console.log(data.usuarios);
        let content=``;
        if (Array.isArray(data.usuarios)) {
      data.usuarios.forEach((usuario) => {
        content += `
          <tr>
            <td>${usuario.idRegistro}</td>
            <td>${usuario.nombre}</td>
            <td>${usuario.identificacion}</td>
            <td>${usuario.direccion}</td>
            <td>${usuario.telefono}</td>
            <td>${usuario.usuario}</td>
            <td>${usuario.correo}</td>
            <td>${usuario.fechaNacimiento}</td>
            <td>${usuario.genero}</td>
            <td>${usuario.tipoUsuario}</td>
            <td>${usuario.is_active}</td>
            <td>
              <button type="button" class="btn btn-warning" onclick="newPerson()" id="add">Editar</button>
              <a href="eliminarUsuario/{{Usuarios.idRegistro}}"><button type="button" class="btn btn-danger" data-dismiss="modal">Eliminar</button></a> 
            </td>
          </tr>
        `;
      });
    } else {
      console.error("data.usuarios is not an array.");
    }
        table_usuarios.innerHTML=content;
    }catch(ex){
        alert(ex);
    }
};

window.addEventListener('load',async()=>{
    await initDataTable();

});
</script>
{% endblock %}