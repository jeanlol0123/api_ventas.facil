{% extends 'base.html' %}
{% block title %}Inicio{% endblock %}
{% load static %}
<!-- bootstrap css -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<!-- FIN bootstrap css -->
<!-- dataTable css -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
<!-- FIN dataTable CSS -->
<!-- font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% block content %}
<h3 class="text-primary font-weight-bolder mb-5">Gestión de proveedores</h3>

<div class="container mt-4">
  <div class="row">
      <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
          <div class="table-responsive">
              <table id="Proveedores" class="table">
                  <caption>
                      Provedores Registrados
                  </caption>
                  <thead>
                      <tr>
                        <th class="tead" data-priority="1">Código</th>
                        <th class="tead" data-priority="2">Proveedor</th>
                        <th class="tead" data-priority="3">Correo</th>
                        <th class="tead" data-priority="4">Dirección</th>
                        <th class="tead" data-priority="5">Teléfono</th>
                        <th class="tead" data-priority="6">Activo</th>
                        <th class="tead" data-priority="7">Acciones</th>
                      </tr>
                  </thead>
                  <tbody id="table_proveedores">
                  
                  </tbody>
              </table>
          </div>
      </div>
  </div>
</div>



<button type="button" class="btn btn-1" onclick="newProoved()">
  <img src="{% static 'images/plus.png' %}" alt="new" class="img">
</button>


<div id="newProov" class="modal fade" role="dialog">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="titulo">Nuevo Proveedor</h4>
      </div>
      <div class="modal-body">
        <form class="col-6" action="/registrarProveedor/" method="POST">{% csrf_token %}
          <label class="label1">Codigo</label>
          <input type="number" class="form-control" id="codigo" name="codigo" readonly>
          <label class="label1">Proveedor</label>
          <input type="text" class="form-control" id="proveedor" name="proveedor" required>
          <label class="label1">Correo</label>
          <input type="text" class="form-control" id="correo" name="correo" required>
          <label class="label1">Direccion</label>
          <input type="text" class="form-control" id="direccion" name="direccion"required>
          <label class="label1">Telefono</label>
          <input type="tel" class="form-control" id="telefono" name="telefono" onkeypress='return validar_num(event)' required>
          <label class="label1">Activo</label>
          <select class="selector" id="activo" name="activo" required>
            <option selected disabled>Seleccione si está activo</option>
            <option value="true">Activo</option>
            <option value="false">Inactivo</option>
          </select>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success" id="add">Añadir</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<!-- bootstrap js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<!-- FIN bootstrap js -->

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<!-- jquery -->
<!-- dataTable js -->
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<!-- FIN dataTable js -->



<script>
  
  let dataTable;
  let dataTableIsInitialized= false;

  const dataTableOptions={
    columnDefs:[
        {orderable:false,targets:[5]},
        {searchable:false,targets:[0,2,3]}
    ]
  };

  const initDataTable= async()=>{
      if(dataTableIsInitialized){
          dataTable.destroy();
      }


      await verProveedores();
      dataTable=$('#Proveedores').DataTable(dataTableOptions);
      dataTableIsInitialized=true;
  };

  const verProveedores=async()=>{
    try{
        const response = await fetch('http://127.0.0.1:8000/verProveedores/')
        const data = await response.json();
        console.log(data.proveedores);
        let content=``;
        if (Array.isArray(data.proveedores)) {
      data.proveedores.forEach((proveedor) => {
        content += `
          <tr>
            <td>${proveedor.Codigo}</td>
            <td>${proveedor.Proveedor}</td>
            <td>${proveedor.Correo}</td>
            <td>${proveedor.Direccion}</td>
            <td>${proveedor.Telefono}</td>
            <td>${proveedor.Activo}</td>
            <td>
              <button type="button" class="btn btn-warning" onclick="agregar()" data-dismiss="modal" id="add">Editar</button>
              <button type="button" class="btn btn-danger" data-dismiss="modal">Eliminar</button>
            </td>
          </tr>
        `;
      });
    } else {
      console.error("data.usuarios is not an array.");
    }
    table_proveedores.innerHTML=content;
    }catch(ex){
        alert(ex);
    }
};

window.addEventListener('load',async()=>{
    await initDataTable();

});
  
  
  
  
  
  $(document).ready(function () {
    $("#personas").DataTable(param_lang());
  });
  function param_lang() {
    var params = {
      language: {
        lengthMenu: "Mostrar _MENU_ por página",
        zeroRecords: "No hay resultados",
        info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
        infoEmpty: "No hay resultados",
        infoFiltered: "(filtrando sobre _MAX_ registros)",
        search: "Buscar",
        paginate: {
          first: "Primer",
          last: "Último",
          next: "Siguiente",
          previous: "Anterior",
        },
      },
      pageLength: 25,
    };

    return params;
  }
</script>
{% endblock %}